---
title: "JavaScript SDK"
description: "Documentation for ApexxCloud JavaScript SDK"
---

## Installation

<CodeGroup>

```bash npm
npm install @apexxcloud/sdk-js
```

```bash yarn
yarn add @apexxcloud/sdk-js
```

</CodeGroup>

## Initialization

```javascript
import ApexxCloud from "@apexxcloud/sdk-js";

const storage = new ApexxCloud({
  baseUrl: "https://api.apexxcloud.com", // optional
});
```

## Backend Implementation

Your backend needs to implement an endpoint that generates signed URLs. Here's an example using Node.js:

```javascript
const ApexxCloud = require("@apexxcloud/sdk-node");

const storage = new ApexxCloud({
  accessKey: "your-access-key",
  secretKey: "your-secret-key",
  region: "bucket-region",
  bucket: "bucket-name",
});

app.post("/api/get-signed-url/:type", async (req, res) => {
  try {
    const { type } = req.params;
    const params = req.body; // Contains key, mimeType, totalParts, etc.

    const signedUrl = await storage.getSignedUrl(
      "your-bucket-name",
      params.key,
      {
        type: type,
        ...params,
      }
    );

    res.send(signedUrl);
  } catch (error) {
    res.status(500).send(error.message);
  }
});
```

The endpoint should handle these types of requests:

| Type              | Description               | Required Parameters                   | Example Response                                                         |
| ----------------- | ------------------------- | ------------------------------------- | ------------------------------------------------------------------------ |
| upload            | Single file upload        | key, mimeType                         | `https://api.apexxcloud.com/upload?signature=...`                        |
| start-multipart   | Start multipart upload    | key, totalParts, mimeType             | `https://api.apexxcloud.com/multipart/start?signature=...`               |
| uploadpart        | Upload individual part    | uploadId, partNumber, key, totalParts | `https://api.apexxcloud.com/multipart/{uploadId}/upload?signature=...`   |
| completemultipart | Complete multipart upload | uploadId, key                         | `https://api.apexxcloud.com/multipart/{uploadId}/complete?signature=...` |
| cancelmultipart   | Cancel multipart upload   | uploadId, key                         | `https://api.apexxcloud.com/multipart/{uploadId}/cancel?signature=...`   |

## File Upload

### Basic Upload

```javascript
const controller = new AbortController();

// Function to get signed URLs from your backend
const getSignedUrl = async (type, params) => {
  const response = await fetch(`/api/get-signed-url/${type}`, {
    method: "POST",
    body: JSON.stringify(params),
  });
  return response.text();
};

try {
  const result = await storage.files.upload(file, getSignedUrl, {
    signal: controller.signal,

    onStart: (event) => {
      console.log("Upload started:", event);
      // event.type: 'start'
      // event.timestamp: Start time
      // event.file: {
      //   name: string,
      //   size: number,
      //   type: string
      // }
    },

    onProgress: (event) => {
      console.log(`Upload progress: ${event.progress}%`);
      // event.loaded: Bytes uploaded
      // event.total: Total bytes
      // event.progress: Percentage complete (0-100)
      // event.type: 'progress'
    },

    onComplete: (event) => {
      console.log("Upload completed:", event);
      // event.type: 'complete'
      // event.response: Server response
      // event.timestamp: Completion time
      // event.file: File metadata
    },

    onError: (event) => {
      console.error("Upload failed:", event);
      // event.type: 'error' | 'abort'
      // event.error: Error object
      // event.timestamp: Error time
      // event.status?: HTTP status code (if applicable)
    },
  });
} catch (error) {
  console.error("Upload failed:", error);
}

// To cancel the upload:
controller.abort();
```

### Multipart Upload

```javascript
const controller = new AbortController();

try {
  const result = await storage.files.uploadMultipart(file, getSignedUrl, {
    signal: controller.signal,
    partSize: 5 * 1024 * 1024, // 5MB chunks (optional)
    concurrency: 3, // Number of concurrent uploads (optional)

    onProgress: (event) => {
      console.log(`Total progress: ${event.progress}%`);
      console.log(
        `Part ${event.part.number} progress: ${event.part.progress}%`
      );
      // event.loaded: Total bytes uploaded
      // event.total: Total file size
      // event.progress: Overall percentage
      // event.part: {
      //   number: Current part number
      //   progress: Current part progress (0-100)
      // }
    },

    onPartComplete: (part) => {
      console.log("Part completed:", part);
      // part.ETag: Part ETag from server
      // part.PartNumber: Completed part number
    },

    onComplete: (event) => {
      console.log("Upload completed:", event);
      // event.type: 'complete'
      // event.response: Server response
      // event.timestamp: Completion time
      // event.file: File metadata
    },

    onError: (event) => {
      console.error("Upload error:", event);
      // event.type: 'error' | 'abort'
      // event.error: Error object
      // event.phase: 'start' | 'upload' | 'complete' | 'cancel'
      // event.status?: HTTP status code (if applicable)
      // event.timestamp: Error time
    },
  });
} catch (error) {
  console.error("Upload failed:", error);
}
```

### Error Handling

The SDK provides detailed error information through the onError callback:

```javascript
try {
  await storage.files.upload(file, getSignedUrl, {
    onError: (event) => {
      if (event.type === "abort") {
        console.log("Upload was cancelled");
      } else {
        console.error("Upload failed:", event.error.message);
        if (event.status) {
          console.error("HTTP Status:", event.status);
        }
        if (event.phase) {
          // For multipart uploads
          console.error("Failed during phase:", event.phase);
        }
      }
    },
  });
} catch (error) {
  console.error("Upload failed:", error.message);
}
```

### Multipart Upload Phases

The multipart upload process includes different phases where errors might occur:

| Phase    | Description                                   |
| -------- | --------------------------------------------- |
| start    | During the initialization of multipart upload |
| upload   | During the upload of individual parts         |
| complete | During the completion of multipart upload     |
| cancel   | During attempt to cancel a failed upload      |

## Best Practices

1. **Error Handling**

   - Always implement error handling using try-catch and onError callback
   - Handle both upload failures and aborted uploads
   - Check error phases for multipart uploads

2. **Progress Updates**

   - Use onProgress for real-time upload progress
   - For multipart uploads, track both overall and part-specific progress
   - Consider debouncing progress updates for better UI performance

3. **Signed URLs**

   - Implement secure server-side signed URL generation
   - Cache signed URLs when appropriate
   - Handle URL expiration gracefully

4. **Upload Cancellation**
   - Create a new AbortController for each upload
   - Clean up controllers when component unmounts
   - Handle cancellation events appropriately
